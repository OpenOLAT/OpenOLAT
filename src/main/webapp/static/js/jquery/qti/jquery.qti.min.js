(function(v){function w(b,e,f){b.on("click",function(g,q){g=jQuery(this);g.hasClass("oo-choosed")||g.hasClass("oo-selected")||g.addClass("oo-selected")}).draggable({containment:"#"+e,scroll:!1,revert:"invalid",stop:function(g,q){jQuery(this).css({left:"0px",top:"0px"});jQuery(q.helper).removeClass("oo-drag")},helper:function(){var g=jQuery(this);if(!(0<g.parent(".association_box").length)&&t(this,e))return g.removeClass("oo-selected"),g=g.clone(),jQuery(g).attr("id","n"+k()).data("qti-cloned","true").addClass("oo-drag"),
g;g.addClass("oo-drag");return g}}).on("click",{formId:f.formDispatchFieldId},setFlexiFormDirtyByListener)}function t(b,e){var f=jQuery(b);b=f.data("qti-match-max");f=f.data("qti-id");e=jQuery("#"+e+"_panel div[data-qti-id\x3d'"+f+"']").length;return 0==b||e+1<b}function p(b,e,f){b.on("click",function(g,q){var r=jQuery(this);1==jQuery(".o_associate_item",this).length?jQuery(".o_associate_item",this).each(function(l,x){m(x,r,e)}):jQuery("#"+e+"_items .o_associate_item.oo-selected").each(function(l,
x){l=jQuery(x);t(x,e)?(l.removeClass("oo-selected"),h(l.clone(),r,e)):h(l,r,e)});d(e,f);setFlexiFormDirty(f.formDispatchFieldId,!1)}).droppable({drop:function(g,q){var r=jQuery(this);0<jQuery(".o_associate_item",this).length&&jQuery(".o_associate_item",this).each(function(l,x){m(x,r,e)});null!=q.helper&&"true"==jQuery(q.helper).data("qti-cloned")?(g=jQuery(q.draggable),g.removeClass("oo-selected").removeClass("oo-drag"),g=g.clone(),w(g,e,f)):(g=jQuery(q.draggable),g.removeClass("oo-selected").removeClass("oo-drag"));
h(g,r,e);d(e,f);setFlexiFormDirty(f.formDispatchFieldId,!1)}}).on("click",{formId:f.formDispatchFieldId},setFlexiFormDirtyByListener)}function h(b,e,f){b.removeClass("oo-selected").css({left:"0px",top:"0px"}).addClass("oo-choosed").appendTo(e);e.addClass("oo-filled")}function m(b,e,f){e.removeClass("oo-filled");b=jQuery(b);b.removeClass("oo-choosed");e=b.data("qti-id");0==jQuery("#"+f+"_items div[data-qti-id\x3d'"+e+"']").length?b.appendTo(jQuery("#"+f+"_items")):b.remove()}function k(){function b(){return Math.floor(65536*
(1+Math.random())).toString(16).substring(1)}return b()+b()+b()+b()+b()+b()+b()}function d(b,e){var f=jQuery("#"+b+"_panel");f.find("input[type\x3d'hidden']").remove();jQuery("#"+b+"_panel .association").each(function(g,q){g=jQuery(q).find(".o_associate_item");2==g.length?(q=jQuery(g.get(0)).data("qti-id"),g=jQuery(g.get(1)).data("qti-id"),q=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+e.responseIdentifier).attr("value",q+" "+g),f.prepend(q)):0==g.length&&e.unrestricted?
q.remove():jQuery(q).find(".association_box").each(function(r,l){0==jQuery(l).find(".o_associate_item").length&&jQuery(l).hasClass("oo-filled")&&jQuery(l).removeClass("oo-filled")})});a(b,e)}function a(b,e){if(e.unrestricted&&e.opened){jQuery("#"+b+"_panel");var f=!0;jQuery("#"+b+"_panel .association").each(function(q,r){2!=jQuery(r).find(".o_associate_item").length&&(f=!1)});if(f){var g=c(b,e);g=jQuery("#"+g+" .association_box");p(g,b,e)}}}function c(b,e){e=k();var f='\x3cdiv id\x3d"'+e+'" class\x3d"association" style\x3d""\x3e\n  \x3cdiv class\x3d"association_box left" style\x3d"width: 100px; height:50px; float:left;"\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"association_box right" style\x3d"width: 100px; height:50px; float:right;"\x3e\x3c/div\x3e\n  \x3cdiv style\x3d"clear:both; "\x3e\x3c/div\x3e\n\x3c/div\x3e\n';
jQuery("#"+b+"_panel").append(f);jQuery("#"+b+"_panel").append('\x3cdiv style\x3d"clear:both; "\x3e\x3c/div\x3e\n');return e}v.fn.associateInteraction=function(b){b=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,opened:!1,unrestricted:!1},b);try{if("undefined"!=typeof b.responseValue&&0<b.responseValue.length){for(var e=this.attr("id"),f=b.responseValue.split(","),g=jQuery("#"+e+"_panel .association"),q=0;q<f.length;q++){var r=f[q].split(" "),l=jQuery(g.get(q));if(0==
l.length){var x=c(e,b);l=jQuery("#"+x)}var y=jQuery("#"+e+"_items div[data-qti-id\x3d'"+r[0]+"']");t(y,e)&&(y=jQuery(y).clone());var z=jQuery("#"+e+"_items div[data-qti-id\x3d'"+r[1]+"']");t(z,e)&&(z=jQuery(z).clone());jQuery(y).addClass("oo-choosed");jQuery(z).addClass("oo-choosed");jQuery(l.find(".association_box.left")).addClass("oo-filled").append(y);jQuery(l.find(".association_box.right")).addClass("oo-filled").append(z)}d(e,b);b.unrestricted&&b.opened&&a(e,b)}if(b.opened){var A=this.attr("id"),
C=jQuery("#"+A+" .o_associate_item");w(C,A,b);var n=jQuery("#"+A+"_panel .association_box");p(n,A,b)}}catch(u){window.console&&console.log(u)}return this}})(jQuery);
(function(v){function w(p,h){jQuery("#qti_container_"+h.responseIdentifier+" input[type\x3dcheckbox]").on("click",function(m,k){t(h)})}function t(p){var h=jQuery("#qti_container_"+p.responseIdentifier+" input[type\x3dcheckbox]"),m=0;h.each(function(k,d){d.checked&&m++});m>=p.maxChoices?h.each(function(k,d){d.disabled=d.checked?!1:!0}):h.each(function(k,d){d.disabled=!1})}v.fn.choiceInteraction=function(p){p=v.extend({responseIdentifier:null,formDispatchFieldId:null,maxChoices:0},p);try{0<p.maxChoices&&
(w(this,p),t(p))}catch(h){window.console&&console.log(h)}return this}})(jQuery);
(function(v){function w(d,a,c){var b=a.value,e=b.split(" ");c(d,a,b,d.gapChoiceMap[e[0]],d.gapMap[e[1]])}function t(d,a){if(a.opened)p(a.responseIdentifier).on("click",function(){k(a,this);setFlexiFormDirty(a.formDispatchFieldId)});h(a);m(a)}function p(d){return jQuery("input[name\x3dqtiworks_response_"+d+"]")}function h(d){d.matchCount=0;for(var a in d.gapChoiceMap)d.gapChoiceMap[a].matchCount=0;for(a in d.gapMap)d.gapMap[a].matched=!1,d.gapMap[a].matchedGapChoice=null;p(d.responseIdentifier).each(function(b,
e){w(d,this,function(f,g,q,r,l){g.checked&&(r.matchCount++,l.matched=!0,l.matchedGapChoice=r,f.matched[q]=!0)})});for(a in d.gapMap){var c=d.gapMap[a];c.query.text(c.matched?c.matchedGapChoice.text:c.label)}}function m(d){p(d.responseIdentifier).each(function(){w(d,this,function(a,c,b,e,f){c.disabled=a.opened?c.checked?!1:f.matched||0!=e.matchMax&&e.matchCount>=e.matchMax?!0:!1:!0})})}function k(d,a){w(d,a,function(c,b,e,f,g){b.checked?(g.matched||0!=f.matchMax&&f.matchMax<=f.matchCount?b.checked=
!1:(f.matchCount++,g.matched=!0,g.matchedGapChoice=f),g.query.text(f.text)):(f.matchCount--,g.matched=!1,g.matchedGapChoice=null,g.query.text(g.label));m(c)})}v.fn.gapMatchInteraction=function(d){d=v.extend({responseIdentifier:null,formDispatchFieldId:null,gapChoiceData:{},gapData:{},opened:!1,gapChoiceMap:{},gapMap:{},matched:{}},d);for(var a in d.gapChoiceData){var c=jQuery("#qtiworks_id_"+d.responseIdentifier+"_"+a);d.gapChoiceMap[a]={matchMax:d.gapChoiceData[a],matchCount:0,query:c,text:c.text()}}for(a in d.gapData)c=
jQuery("#qtiworks_id_"+d.responseIdentifier+"_"+a),d.gapMap[a]={required:d.gapData[a],matched:!1,matchedGapChoice:null,query:c,label:c.text()};try{t(this,d)}catch(b){window.console&&console.log(b)}return this}})(jQuery);
(function(v){function w(h,m,k){var d=h.attr("id");jQuery("#"+d+"_container area").on("click",function(a){a=jQuery("#"+d+"_container").data("openolat")||{};void 0==a.listOfPairs&&(a.currentSpot="",a.listOfPairs=[],jQuery("#"+d+"_container").data("openolat",a));var c=jQuery(this).data("qti-id");""==a.currentSpot||a.currentSpot==c?a.currentSpot=c:(a.listOfPairs.push([a.currentSpot,c]),a.currentSpot="");var b=document.getElementById(d+"_canvas");c=b.getContext("2d");c.clearRect(0,0,jQuery(b).width(),
jQuery(b).height());b=jQuery("#"+d+"_container");b.find("input[type\x3d'hidden']").remove();var e=[];""!=a.currentSpot&&(t(c,"ac_"+k+"_"+a.currentSpot),e.push(a.currentSpot));for(var f=a.listOfPairs.length;0<f--;){for(var g=a.listOfPairs[f],q=g.length;0<q--;)0>e.indexOf(g[q])&&(t(c,"ac_"+k+"_"+g[q]),e.push(g[q]));q=jQuery("#ac_"+k+"_"+g[1]);g=jQuery("#ac_"+k+"_"+g[0]);var r=p(q),l=p(g);c.beginPath();c.moveTo(r[0],r[1]);c.lineTo(l[0],l[1]);c.lineWidth=3;c.stroke();q=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name",
"qtiworks_response_"+k).attr("value",g.data("qti-id")+" "+q.data("qti-id"));b.prepend(q)}})}function t(h,m){jQuery("#"+m).each(function(k,d){d=jQuery(d);k=p(d);d=d.attr("shape");var a;var c=a=0;h.beginPath();if("rect"==d)h.rect(k[0]+a,k[1]+c,k[2]-k[0],k[3]-k[1]);else if("poly"==d)for(h.moveTo(k[0]+a,k[1]+c),i=2;i<k.length;i+=2)h.lineTo(k[i]+a,k[i+1]+c);else"circ"!=d&&"circle"!=d||h.arc(k[0]+a,k[1]+c,k[2]-2,0,2*Math.PI,!1);h.closePath();h.lineWidth=4;h.strokeStyle="#003300";h.stroke();h.fillStyle=
"green";h.fill()})}function p(h){h=h.attr("coords").split(",");for(i=h.length;0<i--;)h[i]=parseFloat(h[i]);return h}v.fn.graphicAssociateInteraction=function(h){h=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxAssociations:1,opened:!1},h);try{if("undefined"!==typeof h.responseValue&&0<h.responseValue.length){var m=h.responseValue,k=h.responseIdentifier,d=this.attr("id"),a=jQuery("#"+d+"_container"),c=document.getElementById(d+"_canvas"),b=c.getContext("2d");b.clearRect(0,
0,jQuery(c).width(),jQuery(c).height());d=[];for(var e=m.split(","),f=e.length;0<f--;){for(var g=e[f].split(" "),q=g.length;0<q--;)0>d.indexOf(g[q])&&(t(b,"ac_"+k+"_"+g[q]),d.push(g[q]));if(2==g.length){var r=jQuery("#ac_"+k+"_"+g[1]),l=jQuery("#ac_"+k+"_"+g[0]),x=p(r),y=p(l);b.beginPath();b.moveTo(x[0],x[1]);b.lineTo(y[0],y[1]);b.lineWidth=3;b.stroke();var z=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+k).attr("value",l.data("qti-id")+" "+r.data("qti-id"));a.prepend(z)}}}h.opened&&
w(this,h.maxAssociations,h.responseIdentifier)}catch(A){window.console&&console.log(A)}return this}})(jQuery);
(function(v){function w(h,m){var k=h.attr("id");jQuery(".gap_item").on("click",function(d,a){d=jQuery(this);if(d.hasClass("oo-choosed"))if(a=d.data("drop-timestamp"),"undefined"!==typeof a&&null!=a&&1500>Date.now()-a)d.data("drop-timestamp",null);else{d.removeClass("oo-choosed");var c=d.data("qti-id");jQuery("#"+k).find("input[type\x3d'hidden']").each(function(b,e){0==jQuery(e).val().indexOf(c+" ")&&jQuery(e).remove()});d.css({position:"relative",left:"0px",top:"0px"})}else d.addClass("oo-selected")}).draggable({containment:"#"+
k,scroll:!1,revert:"invalid",stop:function(d,a){jQuery(this).hasClass("oo-choosed")||jQuery(this).css({position:"relative",left:"0px",top:"0px"})}}).mousemove(function(d,a){a=jQuery(this);if(a.hasClass("ui-draggable-dragging")){var c=jQuery("#"+k+"_img").offset(),b=a.offset();d=b.left+a.width()/2-c.left;a=b.top+a.height()/2-c.top;var e=t(d,a,k);"invalid"!=e?(jQuery("#"+k+" area").each(function(f,g){f=jQuery(g);g=f.attr("id");e==g?f.mouseover():f.mouseout()}),jQuery("#"+e).mouseover()):jQuery("#"+
k+" area").each(function(f,g){jQuery(g).mouseout()})}});jQuery("#"+k).droppable({drop:function(d,a){d=jQuery("#"+k+"_img").offset();a=jQuery(a.draggable);var c=a.offset(),b=c.left+a.width()/2-d.left;d=c.top+a.height()/2-d.top;d=t(b,d,k);if("invalid"!=d){d=jQuery("#"+d);b=p(d);c=d.data("qti-id");var e=a.data("qti-id");a.css("position","absolute");a.css("left",b[0]+"px");a.css("top",b[1]+"px");a.css("border","none");a.removeClass("oo-selected");a.addClass("oo-choosed");b=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name",
"qtiworks_response_"+m.responseIdentifier).attr("value",e+" "+c);jQuery(this).prepend(b);jQuery(d).mouseout();a.data("drop-timestamp",Date.now())}}});jQuery("#"+k+" area").on("click",function(d,a){var c=jQuery(this);jQuery(".gap_item.oo-selected").each(function(b,e){var f=jQuery(e),g=p(c);b=c.data("qti-id");e=f.data("qti-id");f.css("position","absolute");f.css("left",g[0]+"px");f.css("top",g[1]+"px");f.css("border","none");f.removeClass("oo-selected");f.addClass("oo-choosed");f=jQuery("#"+k);b=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name",
"qtiworks_response_"+m.responseIdentifier).attr("value",e+" "+b);f.prepend(b)})})}function t(h,m,k){var d="invalid";jQuery("#"+k+" area").each(function(a,c){c=jQuery(c);a=c.attr("id");c.attr("coords");var b=c.attr("shape");c=p(c);if("circle"==b)Math.pow(c[2],2)>=Math.pow(h-c[0],2)+Math.pow(m-c[1],2)&&(d=a);else if("rect"==b)c=c[0]<=h&&h<=c[2]&&c[1]<=m&&m<=c[3]?!0:!1,c&&(d=a);else if("poly"==b){a={x:[],y:[]};b=c.length/2;var e=0;for(ix=0;ix<b;ix++)a.x[ix]=c[e],a.y[ix]=c[e+1],e+=2;for(i=0;i<a.length;i++){e=
a.x.length;var f=a.x,g=a.y,q=!1;b=0;for(c=e-1;b<e;c=b++)g[b]>m!=g[c]>m&&h<(f[c]-f[b])*(m-g[b])/(g[c]-g[b])+f[b]&&(q=!q);if(q){d=a.id;break}}}});return d}function p(h){h=h.attr("coords").split(",");for(i=h.length;0<i--;)h[i]=parseFloat(h[i]);return h}v.fn.graphicGapInteraction=function(h){h=v.extend({maphilight:null,responseIdentifier:null,formDispatchFieldId:null,responseValue:null,opened:!1},h);try{if("undefined"!==typeof h.responseValue&&0<h.responseValue.length)for(var m=this.attr("id"),k=jQuery("#"+
m),d=h.responseValue.split(","),a=d.length;0<a--;){var c=d[a].split(" "),b=jQuery("#ac_"+h.responseIdentifier+"_"+c[0]),e=jQuery("#ac_"+h.responseIdentifier+"_"+c[1]);if(b.hasClass("gap_item")){var f=b;var g=e}else f=e,g=b;var q=p(g);f.css("position","absolute");f.css("left",q[0]+"px");f.css("top",q[1]+"px");f.addClass("oo-choosed");var r=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+h.responseIdentifier).attr("value",f.data("qti-id")+" "+g.data("qti-id"));k.prepend(r)}h.opened&&
w(this,h)}catch(l){window.console&&console.log(l)}return this}})(jQuery);
(function(v){function w(t,p){var h=t.attr("id");jQuery("#"+h+"_container area").on("click",function(m){var k=jQuery(this).attr("id"),d=jQuery(this).data("qti-id");m=jQuery(this).attr("coords").split(",");var a=m[0],c=m[1];m=jQuery("#"+h+"_container").data("openolat")||{};void 0==m.listOfPoints&&(m.listOfPoints=[],jQuery("#"+h+"_container").data("openolat",m));for(var b=!1,e=[],f=m.listOfPoints.length;0<f--;){var g=m.listOfPoints[f];64>(g.x-a)*(g.x-a)+(g.y-c)*(g.y-c)?b=!0:e.push(g)}if(b)m.listOfPoints=
e;else{if(m.listOfPoints.length>=p.maxChoices)return!1;m.listOfPoints.push({x:a,y:c,areaId:k,spotQtiId:d})}f=document.getElementById(h+"_canvas");k=f.getContext("2d");k.clearRect(0,0,jQuery(f).width(),jQuery(f).height());d=jQuery("#"+h+"_container");d.find("input[type\x3d'hidden']").remove();for(f=m.listOfPoints.length;0<f--;)g=m.listOfPoints[f],k.font="16px Arial",k.fillText(""+(f+1),g.x,g.y),g=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+p.responseIdentifier).attr("value",
g.spotQtiId),d.prepend(g)})}v.fn.graphicOrderInteraction=function(t){t=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxChoices:1,opened:!1},t);try{if("undefined"!==typeof t.responseValue&&0<t.responseValue.length){var p=this.attr("id"),h=jQuery("#"+p+"_container"),m=document.getElementById(p+"_canvas"),k=m.getContext("2d");k.clearRect(0,0,jQuery(m).width(),jQuery(m).height());for(var d=t.responseValue.split(","),a=d.length;0<a--;)if(0!=d[a].length){var c=jQuery("#ac_"+
t.responseIdentifier+"_"+d[a]),b=c.data("qti-id"),e=c.attr("coords").split(","),f=e[0],g=e[1];k.font="16px Arial";k.fillText(""+(a+1),f,g);var q=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+t.responseIdentifier).attr("value",b);h.prepend(q)}}t.opened&&w(this,t)}catch(r){window.console&&console.log(r)}return this}})(jQuery);
(function(v){function w(h,m){var k=h.attr("id");jQuery("#"+k+" map area").each(function(d,a){jQuery(a).on("click",function(){t(this,k,m.responseIdentifier,m.maxChoices,m.singleChoice,m.maphilightSettings)})})}function t(h,m,k,d,a,c){h=jQuery(h);var b=h.data("maphilight")||{};if("undefined"===typeof b.selectedOn||!b.selectedOn)if(a&&jQuery("area","map[name\x3d'"+m+"_map']").each(function(g,q){g=jQuery(q).data("maphilight")||{};g.selectedOn&&(g.selectedOn=!1,p(g,c),jQuery(q).data("maphilight",g).trigger("alwaysOn.maphilight"))}),
0<d){var e=0;jQuery("area","map[name\x3d'"+m+"_map']").each(function(g,q){(jQuery(q).data("maphilight")||{}).selectedOn&&e++});if(e>=d)return!1}b.selectedOn="undefined"===typeof b.selectedOn?!0:!b.selectedOn;p(b,c);h.data("maphilight",b).trigger("alwaysOn.maphilight");var f=jQuery("#"+m);f.find("input[type\x3d'hidden']").remove();jQuery("area","map[name\x3d'"+m+"_map']").each(function(g,q){g=jQuery(q);(g.data("maphilight")||{}).selectedOn&&(g=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name",
"qtiworks_response_"+k).attr("value",g.data("qti-id")),f.append(g))})}function p(h,m){h.selectedOn?(h.fillColor=m.selectedFillColor,h.fillOpacity=m.selectedFillOpacity,h.strokeColor=m.selectedStrokeColor,h.strokeOpacity=m.selectedStrokeOpacity,h.shadow=m.selectedShadow,h.shadowX=0,h.shadowY=0,h.shadowRadius=7,h.shadowColor="000000",h.shadowOpacity=.8,h.shadowPosition="outside"):(h.fillColor=m.fillColor,h.fillOpacity=m.fillOpacity,h.strokeColor=m.strokeColor,h.strokeOpacity=m.strokeOpacity,h.shadow=
!1)}v.fn.hotspotInteraction=function(h){h=v.extend({responseIdentifier:null,formDispatchFieldId:null,maxChoices:1,singleChoice:!1,responseValue:null,opened:!1,maphilightSettings:{}},h);try{if("undefined"!==typeof h.responseValue&&0<h.responseValue.length)for(var m=this.attr("id"),k=jQuery("#"+m),d=h.responseValue.split(","),a=d.length;0<a--;){var c=jQuery("#ac_"+h.responseIdentifier+"_"+d[a]),b=c.data("maphilight")||{};b.selectedOn=!0;p(b,h.maphilightSettings);c.data("maphilight",b).trigger("alwaysOn.maphilight");
var e=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+h.responseIdentifier).attr("value",c.data("qti-id"));k.append(e)}h.opened&&w(this,h)}catch(f){window.console&&console.log(f)}return this}})(jQuery);
(function(v){v.fn.rwdImageMaps=function(w){var t=v.extend({fillColor:"bbbbbb",fillOpacity:.5,strokeColor:"6E6E6E",strokeOpacity:1},w),p=this,h=null,m=0,k=0;w=function(){p.each(function(){if("undefined"!=typeof v(this).attr("usemap")){var d=function(b,e){v("\x3cimg /\x3e").on("load",function(){e.data("width")||e.data("width",e.attr("width"));e.data("height")||e.data("height",e.attr("height"));var f=e.data("width"),g=e.data("height");if(!f||!g){var q=new Image;q.src=e.attr("src");f||(f=q.width,e.data("width",
g));g||(g=q.height,e.data("height",g))}q=e.closest(".o_oo_hotcontainer").width();var r=e.width(),l=e.height();q<f?(r=q,l=g/f*q|0,e.width(r),e.height(l)):0==r&&0==l&&(r=f,l=g,e.width(r),e.height(l));var x=r/100,y=l/100;q=e.attr("usemap").replace("#","");v('map[name\x3d"'+q+'"]').find("area").each(function(){var z=v(this);z.data("coords")||z.data("coords",z.attr("coords"));for(var A=z.data("coords").split(","),C=Array(A.length),n=0;n<C.length;++n)C[n]=0===n%2?parseInt(A[n]/f*100*x):parseInt(A[n]/g*
100*y);z.attr("coords",C.toString())});h=!0;e.maphilight({fillColor:t.fillColor,fillOpacity:t.fillOpacity,strokeColor:t.strokeColor,strokeOpacity:t.strokeOpacity,strokeWidth:3,alwaysOn:!0})}).attr("src",e.attr("src"))},a=v(this),c=a.closest(".o_oo_hotcontainer").width();if(h){if(m!=window.innerWidth||k!=c)d(this,a),m=window.innerWidth,k=c}else m=window.innerWidth,k=c,d(this,a)}})};v(window).resize(w).trigger("resize");v(p).closest(".o_qti21_collapsable_solution").on("shown.bs.collapse",w);return this}})(jQuery);
(function(v){function w(a,c){t(c.responseIdentifier).on("click",function(){k(c,this)});h(c);m(c)}function t(a){return jQuery("input[name\x3dqtiworks_response_"+a+"]")}function p(a,c,b){var e=c.value,f=e.split(" ");b(c,e,a.leftMap[f[0]],a.rightMap[f[1]])}function h(a){a.matchCount=0;a.matched={};for(var c in a.leftMap)a.leftMap[c].matchCount=0;for(c in a.rightMap)a.rightMap[c].matchCount=0;t(a.responseIdentifier).each(function(){p(a,this,function(b,e,f,g){b.checked&&(a.matchCount++,f.matchCount++,
g.matchCount++,a.matched[e]=!0)})})}function m(a){t(a.responseIdentifier).each(function(){p(a,this,function(c,b,e,f){c.disabled=c.checked?!1:0!=a.maxAssociations&&a.matchCount>=a.maxAssociations?!0:0!=e.matchMax&&e.matchCount>=e.matchMax?1!=e.matchMax&&1!=e.matchCount?!0:!1:0!=f.matchMax&&f.matchCount>=f.matchMax?!0:!1})})}function k(a,c){p(a,c,function(b,e,f,g){if(b.checked){e=!1;if(1==f.matchMax){e=jQuery(b);var q=e.attr("id"),r=e.attr("value").split(" ")[0];t(a.responseIdentifier).each(function(){p(a,
this,function(l,x,y,z){x=jQuery(l);q!==x.attr("id")&&l.checked&&(x=x.attr("value").split(" ")[0],r===x&&(l.checked=!1,y.matchCount--,z.matchCount--,a.matchCount--))})});f.matchCount++;a.matchCount++;e=!0}else 0!=f.matchMax&&f.matchMax<=f.matchCount?b.checked=!1:(f.matchCount++,a.matchCount++,e=!0);0!=g.matchMax&&g.matchMax<=g.matchCount?b.checked=!1:(g.matchCount++,e||a.matchCount++)}else a.matchCount--,f.matchCount--,g.matchCount--;m(a);b.checked||null==a.unansweredColumn||d(a,b)})}function d(a,
c){var b=jQuery(c).attr("value").split(" ")[0],e=0,f=null;t(a.responseIdentifier).each(function(){p(a,this,function(g,q,r,l){q=jQuery(g);r=q.attr("value").split(" ")[0];b===r&&(g.checked?e++:1==q.closest("."+a.unansweredColumn).length&&(f=g))})});0==e&&null!=f&&(f.checked=!0)}v.fn.matchInteraction=function(a){a=v.extend({responseIdentifier:null,formDispatchFieldId:null,maxAssociations:1,unansweredColumn:null,leftData:{},rightData:{},leftMap:{},rightMap:{},matched:[]},a);for(var c in a.leftData)a.leftMap[c]=
{matchMax:a.leftData[c],matchCount:0};for(c in a.rightData)a.rightMap[c]={matchMax:a.rightData[c],matchCount:0};try{w(this,a)}catch(b){window.console&&console.log(b)}return this}})(jQuery);
(function(v){function w(c,b){jQuery("#"+c+" .o_match_dnd_sources").droppable({tolerance:"pointer",over:function(e,f){jQuery(this).addClass("oo-accepted")},out:function(e,f){jQuery(this).removeClass("oo-accepted")},drop:function(e,f){e=jQuery(this);e.removeClass("oo-accepted");f=jQuery(f.draggable);var g=f.data("qti-id");0<e.find("li[data-qti-id\x3d'"+g+"']").length?0==f.parents(".o_match_dnd_sources").length&&f.remove():f.appendTo(e);a(c,b);setFlexiFormDirty(b.formDispatchFieldId,!1)}}).on("click",
{formId:b.formDispatchFieldId},setFlexiFormDirtyByListener)}function t(c,b,e){c.on("click",function(f,g){f=jQuery(this);f.hasClass("oo-choosed")||f.hasClass("oo-selected")?0<f.parents(".o_match_dnd_targets").length&&!f.hasClass("oo-dropped-mrk")&&(d(f,b),a(b,e),setFlexiFormDirty(e.formDispatchFieldId,!1)):(jQuery("#"+b+" .o_match_dnd_sources .o_match_dnd_source").each(function(q,r){jQuery(r).removeClass("oo-selected")}),f.addClass("oo-selected"))}).draggable({containment:"#"+b,scroll:!1,revert:"invalid",
cursorAt:{left:5,top:5},start:function(f,g){jQuery(g.helper).removeClass("oo-dropped-mrk")},stop:function(f,g){jQuery(this).css({left:"0px",top:"0px","z-index":""});jQuery(g.helper).removeClass("oo-drag")},helper:function(){var f=jQuery(this);if(!(0<f.parent(".o_match_dnd_target").length)&&h(this,b)){f.removeClass("oo-selected");var g=f.clone();jQuery(g).attr("id","n"+p()).data("qti-cloned","true").addClass("oo-drag").addClass("oo-drag-mrk").css("z-index",10).css("width",f.width()).css("height",f.height());
return g}f.addClass("oo-drag").addClass("oo-drag-mrk").css("z-index",10);return f}}).on("click",{formId:e.formDispatchFieldId},setFlexiFormDirtyByListener)}function p(){function c(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return c()+c()+c()+c()+c()+c()+c()}function h(c,b){var e=jQuery(c);if(0<e.parents(".o_match_dnd_target").length)return!1;c=e.data("qti-match-max");e=e.data("qti-id");b=jQuery("#"+b+" .o_match_dnd_targets li[data-qti-id\x3d'"+e+"']").length;return 0==
c||b+1<c}function m(c,b,e){c.on("click",function(f,g){var q=this,r=jQuery(q);0==jQuery(".o_associate_item",this).length&&jQuery("#"+b+" .o_match_dnd_sources .oo-selected").each(function(l,x){l=jQuery(x);var y=l.data("qti-id");y=0==jQuery(".o_match_dnd_source[data-qti-id\x3d'"+y+"']",q).length;var z=jQuery(q).data("qti-match-max");0<z&&jQuery(".o_match_dnd_source",q).length>=z&&(y&=0);y&&(h(x,b)?(l.removeClass("oo-selected"),l=l.clone(),k(l,r,b),t(l,b,e)):k(l,r,b))});a(b,e);setFlexiFormDirty(e.formDispatchFieldId,
!1)}).droppable({tolerance:"pointer",accept:function(f){f=jQuery(f).data("qti-id");if(f=0==jQuery(".o_match_dnd_source[data-qti-id\x3d'"+f+"']",this).length){var g=jQuery(this).data("qti-match-max");0<g&&jQuery(".o_match_dnd_source",this).length>=g&&(f=!1)}return f},over:function(f,g){jQuery(this).addClass("oo-accepted")},out:function(f,g){jQuery(this).removeClass("oo-accepted")},drop:function(f,g){f=jQuery(this);f.removeClass("oo-accepted");var q=jQuery(g.draggable),r=q.data("qti-id");0<jQuery(".o_match_dnd_source[data-qti-id\x3d'"+
r+"']",this).length||(null!=g.helper&&"true"==jQuery(g.helper).data("qti-cloned")?(q.removeClass("oo-selected").removeClass("oo-drag"),q=q.clone(),t(q,b,e)):q.removeClass("oo-selected").removeClass("oo-drag"),k(q,f,b),q.addClass("oo-dropped-mrk"),setTimeout(function(){q.removeClass("oo-dropped-mrk")},100),a(b,e),setFlexiFormDirty(e.formDispatchFieldId,!1))}}).on("click",{formId:e.formDispatchFieldId},setFlexiFormDirtyByListener)}function k(c,b,e){e=b.find("ul.o_match_dnd_target_drop_zone");c.removeClass("oo-selected").css({width:"auto",
left:"0px",top:"0px","z-index":""}).addClass("oo-choosed").appendTo(e);b.addClass("oo-filled")}function d(c,b){c=jQuery(c);c.removeClass("oo-choosed");var e=c.data("qti-id");0==jQuery("#"+b+" .o_match_dnd_sources li[data-qti-id\x3d'"+e+"']").length?c.css({width:"auto",left:"0px",top:"0px","z-index":""}).appendTo(jQuery("#"+b+" .o_match_dnd_sources")):c.remove()}function a(c,b){b.matchCount=0;b.matched={};for(var e in b.leftMap)b.leftMap[e].matchCount=0;for(e in b.rightMap)b.rightMap[e].matchCount=
0;var f=jQuery("#"+c);f.find("input[type\x3d'hidden']").remove();jQuery("#"+c+" .o_match_dnd_target_drop_zone").each(function(g,q){jQuery(q).find(".o_match_dnd_source").each(function(r,l){r=jQuery(l).data("qti-id");l=jQuery(q).data("qti-id");r=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+b.responseIdentifier).attr("value",r+" "+l);f.prepend(r)})})}v.fn.matchInteractionDnd=function(c){c=v.extend({responseIdentifier:null,formDispatchFieldId:null,maxAssociations:1,responseValue:null,
opened:!1},c);try{if("undefined"!=typeof c.responseValue&&0<c.responseValue.length){for(var b=this.attr("id"),e=c.responseValue.split(","),f=0;f<e.length;f++){var g=e[f].split(" "),q=g[1],r=jQuery("#"+b+" .o_match_dnd_sources li[data-qti-id\x3d'"+g[0]+"']");h(r,b)&&(r=jQuery(r).clone());var l=jQuery("#"+b+" .o_match_dnd_targets ul[data-qti-id\x3d'"+q+"']");jQuery(r).addClass("oo-choosed");jQuery(l).addClass("oo-choosed");jQuery(l).addClass("oo-filled").append(r);var x=r.attr("data-qti-scores");if(null!=
x&&0<x.length)for(var y=x.split(";"),z=0;z<y.length;z++){var A=y[z];if(0==A.indexOf(q)){var C=A.split("\x3d")[1];r.append("\x3cdiv style\x3d'text-align: right;' class\x3d'o_qti_score_infos'\x3e"+C+"\x3c/div\x3e")}}}a(b,c);c.unrestricted&&c.opened&&addNewAssociationBoxAndEvents(b,c)}if(c.opened){var n=this.attr("id");w(n,c);var u=jQuery("#"+n+" .o_match_dnd_source");t(u,n,c);var B=jQuery("#"+n+" .o_match_dnd_target");m(B,n,c)}}catch(D){window.console&&console.log(D)}return this}})(jQuery);
(function(v){function w(k,d){k="#qtiworks_response_"+d.responseIdentifier;var a=jQuery(k+" div.source \x3e ul"),c=jQuery(k+" div.target \x3e ul"),b=jQuery(k+" div.source \x3e ul").get(0),e=jQuery(k+" div.target \x3e ul").get(0);dragula([b,e],{copy:function(f,g){return!1},accepts:function(f,g){return g!==b}}).on("drag",function(f,g){}).on("over",function(f,g,q){g===e&&jQuery(g).addClass("oo-accepted")}).on("drop",function(f,g,q,r){m(d);setFlexiFormDirty(d.formDispatchFieldId)}).on("dragend",function(f){jQuery(e).removeClass("oo-accepted")}).on("out",
function(f){jQuery(e).removeClass("oo-accepted")});t(a,c);p(a,c,d)}function t(k,d){k.find("li").on("click",function(a,c){a=jQuery(this);a.hasClass("oo-selected")?(h(k,d),d.removeClass("oo-selected")):(h(k,d),a.addClass("oo-selected"),d.addClass("oo-selected"))})}function p(k,d,a){d.on("click",function(c,b){if(c.target===d.get(0)){b=k.find("li.oo-selected");var e=d.find("li.oo-selected"),f=null;0<b.length?f=b:0<e.length&&(f=e);if(f){f.removeClass("oo-selected");var g=f.attr("id");e=d.find("li");g=
d.find("li#"+g);if(0===e.length)f=f.clone(),d.append(f),d.removeClass("oo-selected");else{var q=d.get(0).getBoundingClientRect();c=c.offsetY;for(var r=0,l,x=!1,y=0;y<e.length;y++){var z=e.get(y),A=z.getBoundingClientRect();l=A.y-q.y;if(c>=r&&c<l){jQuery(z).before(f.clone());x=!0;break}r=l+A.height}x||d.append(f.clone());d.removeClass("oo-selected");0<g.length&&g.remove()}b.remove();m(a)}}else b=jQuery(c.target).closest("li.o_assessmentitem_order_item"),0<b.length&&(b.hasClass("oo-selected")?(h(k,
d),d.removeClass("oo-selected")):(h(k,d),b.addClass("oo-selected"),d.addClass("oo-selected")))})}function h(k,d){d.find("li").each(function(a,c){jQuery(c).removeClass("oo-selected")});k.find("li").each(function(a,c){jQuery(c).removeClass("oo-selected")})}function m(k){var d="#qtiworks_response_"+k.responseIdentifier;jQuery(d+" div.source \x3e ul");var a=jQuery(d+" div.target \x3e ul"),c=jQuery(d+" div.target"),b=jQuery(d+" div.hiddenInputContainer"),e=a.children("li").length;if(null!=k.minChoices&&
null!=k.maxChoices){if(e<k.minChoices||e>k.maxChoices)return k.minChoices!=k.maxChoices?alert("You must select and order between "+k.minChoices+" and "+k.maxChoices+" items"):alert("You must select and order exactly "+k.minChoices+" item"+(1<minChoices?"s":"")),c.toggleClass("highlight",!0),!1;c.toggleClass("highlight",!1)}b=jQuery(d+" div.hiddenInputContainer");b.empty();a.children("li").each(function(f){f=this.id.substring(18);var g=jQuery('\x3cinput type\x3d"hidden"\x3e');g.attr("name","qtiworks_response_"+
k.responseIdentifier);g.attr("value",f);b.append(g)})}v.fn.orderInteraction=function(k){k=v.extend({responseIdentifier:null,formDispatchFieldId:null,minChoices:null,maxChoices:null,responseValue:null,opened:!1},k);try{"undefined"!=typeof k.responseValue&&0<k.responseValue.length&&m(k),k.opened&&w(this,k)}catch(d){window.console&&console.log(d)}return this}})(jQuery);
(function(v){function w(p,h){var m=p.attr("id");p=jQuery("#"+m);var k=h.responseValue.split(":");m=jQuery("#"+m+" .items_container .o_item.o_"+h.responseIdentifier);for(var d=k.length;0<d--;){var a=k[d].split(" "),c=a[0];a=a[1];var b=jQuery(m.get(d));b.css("position","absolute");b.css("top",a+"px");b.css("left",c+"px");b="in-"+b.attr("id")+"-"+h.responseIdentifier;c=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("id",b).attr("name","qtiworks_response_"+h.responseIdentifier).attr("value",c+" "+a);
p.prepend(c)}}function t(p,h){var m=p.attr("id"),k=jQuery("#"+m);jQuery("#"+m+" .items_container .o_item.o_"+h.responseIdentifier).draggable({containment:"#"+m,scroll:!1,stop:function(d,a){a=jQuery("#"+m+"_img");d=jQuery(a).offset().top-jQuery(window).scrollTop();a=jQuery(a).offset().left-jQuery(window).scrollLeft();var c=jQuery(this).offset().top-jQuery(window).scrollTop(),b=jQuery(this).offset().left-jQuery(window).scrollLeft();a=Math.round(b-a);d=Math.round(c-d);c="in-"+jQuery(this).attr("id")+
"-"+h.responseIdentifier;b=k.find("#"+c);0==b.length?(d=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("id",c).attr("name","qtiworks_response_"+h.responseIdentifier).attr("value",a+" "+d),k.prepend(d)):b.val(a+" "+d);setFlexiFormDirty(h.formDispatchFieldId)}})}v.fn.positionObjectStage=function(p){p=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxChoices:1,opened:!1},p);try{var h=this.attr("id");jQuery("#"+h+" .items_container .o_item.o_"+p.responseIdentifier).each(function(m,
k){jQuery(k).attr("id","object-item-"+m)});"undefined"!==typeof p.responseValue&&0<p.responseValue.length&&w(this,p);p.opened&&t(this,p)}catch(m){window.console&&console.log(m)}return this}})(jQuery);
(function(v){function w(t,p){var h=t.attr("id");jQuery("#"+h+"_canvas").on("click",function(m,k){var d=jQuery(this).offset().top-jQuery(window).scrollTop();k=jQuery(this).offset().left-jQuery(window).scrollLeft();k=Math.round(m.clientX-k);var a=Math.round(m.clientY-d);m=jQuery("#"+h).data("openolat")||{};void 0==m.listOfPoints&&(m.listOfPoints=[],jQuery("#"+h).data("openolat",m));var c=!1,b=[];for(i=m.listOfPoints.length;0<i--;)d=m.listOfPoints[i],Math.pow(8,2)>(d.x-k)*(d.x-k)+(d.y-a)*(d.y-a)?c=!0:
b.push(d);if(c)m.listOfPoints=b;else{if(m.listOfPoints.length>=p.maxChoices)return!1;m.listOfPoints.push({x:k,y:a})}d=document.getElementById(h+"_canvas");k=d.getContext("2d");k.clearRect(0,0,jQuery(d).width(),jQuery(d).height());a=jQuery("#"+h);a.find("input[type\x3d'hidden']").remove();for(i=m.listOfPoints.length;0<i--;)d=m.listOfPoints[i],k.beginPath(),k.arc(d.x,d.y,8,0,2*Math.PI,!1),k.stroke(),k.closePath(),d=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+p.responseIdentifier).attr("value",
d.x+" "+d.y),a.append(d);setFlexiFormDirty(p.formDispatchFieldId)})}v.fn.selectPointInteraction=function(t){t=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxChoices:1,opened:!1},t);try{if("undefined"!==typeof t.responseValue&&0<t.responseValue.length){var p=this.attr("id"),h=jQuery("#"+p),m=t.responseValue.split(":"),k=document.getElementById(p+"_canvas"),d=k.getContext("2d");d.clearRect(0,0,jQuery(k).width(),jQuery(k).height());for(i=m.length;0<i--;)if(0!=m[i].length){var a=
m[i].split(" "),c=a[0],b=a[1];d.beginPath();d.arc(c,b,8,0,2*Math.PI,!1);d.stroke();d.closePath();var e=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+t.responseIdentifier).attr("value",c+" "+b);h.append(e)}}t.opened&&w(this,t)}catch(f){window.console&&console.log(f)}return this}})(jQuery);
(function(v){function w(t,p){var h=jQuery("#qtiworks_id_slider_"+p.responseIdentifier);t=jQuery('input[name\x3d"qtiworks_response_'+p.responseIdentifier+'"]').get(0).value||p.min;h.slider({value:t,step:p.step,disabled:!p.opened,orientation:p.orientation,min:p.isReversed?-p.max:p.min,max:p.isReversed?-p.min:p.max,slide:function(m,k){m=p.isReversed?-k.value:k.value;k=jQuery("#qtiworks_id_slidervalue_"+p.responseIdentifier);jQuery('input[name\x3d"qtiworks_response_'+p.responseIdentifier+'"]').get(0).value=
m;k.text(m);h.slider("value",p.isReversed?-m:m);setFlexiFormDirty(p.formDispatchFieldId)}})}v.fn.sliderInteraction=function(t){t=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,min:1,max:1,step:1,orientation:null,isReversed:!1,isDiscrete:!1,opened:!1,initialValue:null},t);try{w(this,t)}catch(p){window.console&&console.log(p)}return this}})(jQuery);
(function(v){v.fn.qtiCopyPaste=function(w){function t(k){k=k.replace(/\t/g,"");return k=k.replace(/(\r\n|\n|\r)/g,"")}var p=v.extend({errorHeader:null,errorMessage:null},w);w=function(){var k="",d=document.activeElement;"textarea"==(d?d.tagName.toLowerCase():null)&&"number"==typeof d.selectionStart?k=d.value.slice(d.selectionStart,d.selectionEnd):window.getSelection&&(k=document.getSelection().toString());h=k;return!0};var h="",m=document.getElementById(this.attr("id"));m.addEventListener("copy",
w,!1);m.addEventListener("cut",w,!1);m.addEventListener("paste",function(k){var d=k.clipboardData.getData("text");t(d)!==t(h)&&(k.preventDefault(),showMessageBox("warn",p.errorHeader,p.errorMessage));return!0});return this}})(jQuery);
(function(v){v.fn.qtiCountWord=function(w){var t=v.extend({responseUniqueId:null,labelSingular:"xxx word",labelPlural:"xxx words"},w),p=function(a,c){if(1==a.nodeType)if(("SPAN"===a.nodeName||"DIV"===a.nodeName)&&a.classList.contains("math"))c.formulas++;else{if(a.hasChildNodes()){a=a.childNodes;for(var b=a.length;0<b--;)p(a[b],c)}}else 3==a.nodeType&&(a=a.nodeValue.replace(/\u00a0/g," "),c.text+=" "+a)};this.countHtml=function(a){var c=document.createElement("div");c.innerHTML=a;a={text:"",formulas:0};
p(c,a);c=m(a.text);k(c+a.formulas)};var h=function(a){a=m(a);k(a)};this.countText=h;var m=function(a){a=a.match(/[\w\u00C0-\u00ff]+/g);var c=0;if(null!=a)for(var b=a.length;0<b--;)1<a[b].length&&c++;return c},k=function(a){var c=jQuery(d).parent().get(0),b=1<a?t.labelPlural:t.labelSingular;b=b.replace("xxx",""+a);jQuery(".o_qti_essay_num_of_words",c).text(b)},d="#oo_"+t.responseUniqueId;if(!jQuery(d).hasClass("o_richtext_mce"))jQuery("#oo_"+t.responseUniqueId).on("keyup",function(a){a=jQuery(d);h(a.val())});
return this}})(jQuery);
(function(v){v.fn.paintV2=function(t){var p=this.data("data-oo-paint-v2");"undefined"===typeof p&&(p=new w(this,t),this.data("data-oo-paint-v2",p));return p};var w=function(t,p){function h(){try{setFlexiFormDirty(q)}catch(n){window.console&&console.log(n)}}function m(n){k();jQuery(n).addClass("active")}function k(){jQuery("#"+r+" div.o_group_tools a").removeClass("active")}function d(){l.freeDrawingBrush.width=b();l.freeDrawingBrush.color=a()}function a(){var n=jQuery("#"+r+" div.o_group_colors a.active"),
u="rgba(0,0,0,1.0)";0<n.length&&(u=n[0].getAttribute("data-color"));n=parseInt(jQuery("#"+r+" div.opacity_range_ui").slider("value"));100>n&&(n/=100,u=u.substring(0,u.lastIndexOf(",")),u+=","+n+")");return u}function c(n){var u=n.lastIndexOf(","),B=n.substring(0,u);jQuery("#"+r+" div.o_group_colors a").each(function(D,E){(D=E.getAttribute("data-color"))&&0==D.indexOf(B)?jQuery(E).addClass("active"):jQuery(E).removeClass("active")});n=Math.round(100*parseFloat(n.substring(u+1,n.length-1)));0<=n&&100>=
n&&jQuery("#"+r+" div.opacity_range_ui").slider("value",n)}function b(){var n=jQuery("#"+r+" div.width_range_ui").slider("value");0==n&&(n=1);return n/2}function e(n){0<=n&&100>=n&&jQuery("#"+r+" div.width_range_ui").slider("value",2*n)}function f(){y.clearRect(0,0,x.width,x.height);var n=b()/2,u=a(),B=x.width/2,D=n+1;y.beginPath();y.arc(B,D,n,0,2*Math.PI,!1);y.fillStyle=u;y.fill();if(0==u.indexOf("rgba(255,255,255,")||0==u.indexOf("#ff0000"))y.strokeStyle="#000000",y.lineWidth="1",y.stroke()}this.settings=
v.extend({inputHolderId:"",formDispatchFieldId:""},p);const g=this.settings.inputHolderId,q=this.settings.formDispatchFieldId;var r="paintw_"+g,l=new fabric.Canvas("paint_"+g,{isDrawingMode:!1,preserveObjectStacking:!0});fabric.Object.prototype.erasable=!0;fabric.Object.prototype.transparentCorners=!1;fabric.Object.prototype.cornerColor="#2980b9";fabric.Object.prototype.borderColor="#2980b9";var x=document.querySelector("#"+r+" canvas.brush_size"),y=x.getContext("2d");(function(){jQuery("#"+r+" div.o_group_tools a[data-tool\x3dselect]").on("click",
function(){m(this);l.isDrawingMode=!1;C()});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dfront]").on("click",function(){l.isDrawingMode=!1;var n=l.getActiveObject();null!=n&&(n.bringToFront(),l.renderAll());C();h()});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dback]").on("click",function(){l.isDrawingMode=!1;var n=l.getActiveObject();null!=n&&(n.sendToBack(),l.renderAll());C();h()})})();(function(){jQuery("#"+r+" div.o_group_tools a[data-tool\x3dtext]").on("click",function(){l.isDrawingMode=
!1;k();var n=a(),u=b();n=new fabric.Textbox("Hello",{left:35,top:20,fill:n,fontFamily:"helvetica",fontSize:Math.floor(2.5*u),originX:"left",hasRotatingPoint:!1,centerTransform:!0,strokeUniform:!0});l.add(n);n.bringToFront();l.setActiveObject(n)});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dcircle]").on("click",function(){l.isDrawingMode=!1;k();var n=a(),u=b();n=new fabric.Circle({left:45,top:25,radius:65,originX:"left",fill:"rgba(255,255,255,0.0)",strokeWidth:u,stroke:n,hasRotatingPoint:!1,centerTransform:!0,
strokeUniform:!0});n.setControlsVisibility({ml:!1,mb:!1,mr:!1,mt:!1,mtr:!1});l.add(n);n.bringToFront();l.setActiveObject(n)});jQuery("#"+r+" div.o_group_tools a[data-tool\x3drectangle]").on("click",function(){l.isDrawingMode=!1;k();var n=a(),u=b();n=new fabric.Rect({left:50,top:30,width:50,height:50,originX:"left",fill:"rgba(255,255,255,0.0)",strokeWidth:u,stroke:n,hasRotatingPoint:!1,centerTransform:!0,strokeUniform:!0});l.add(n);n.bringToFront();l.setActiveObject(n)});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dellipse]").on("click",
function(){l.isDrawingMode=!1;k();var n=a(),u=b();n=new fabric.Ellipse({left:15,top:10,rx:65,ry:35,fill:"rgba(255,255,255,0.0)",strokeWidth:u,stroke:n,hasRotatingPoint:!1,centerTransform:!0,strokeUniform:!0});l.add(n);n.bringToFront();l.setActiveObject(n)})})();(function(){jQuery("#"+r+" div.o_group_tools a[data-tool\x3deraser]").on("click",function(){m(this);l.isDrawingMode=!0;l.freeDrawingBrush=new fabric.EraserBrush(l);l.freeDrawingBrush.width=b()});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dbrush]").on("click",
function(){m(this);l.isDrawingMode=!0;l.freeDrawingBrush=new fabric.PencilBrush(l);d()}).each(function(n,u){m(this)});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dspray]").on("click",function(){m(this);l.isDrawingMode=!0;l.freeDrawingBrush=new fabric.SprayBrush(l);d()})})();(function(){jQuery("#"+r+" div.o_group_tools a[data-tool\x3dline]").on("click",function(){l.isDrawingMode=!1;m(this)});var n,u=!1;l.on("mouse:down",function(B){var D=jQuery("#"+r+" div.o_group_tools a.active");D=null!=D&&0!=
D.length?D[0].getAttribute("data-tool"):null;if(l.isDrawingMode)d();else if("line"===D){u=!0;D=a();var E=b();B=l.getPointer(B.e);n=new fabric.Line([B.x,B.y,B.x,B.y],{stroke:D,strokeWidth:E,originX:"center",originY:"center"});l.add(n)}});l.on("mouse:move",function(B){u&&(B=l.getPointer(B.e),n.set({x2:B.x,y2:B.y}),l.renderAll())});l.on("mouse:up",function(B){u&&(u=!1,l.discardActiveObject().renderAll(),C())})})();(function(){jQuery("#"+r+" div.width_range_ui").slider({min:1,max:100,value:20,change:function(n,
u){n=u.value/2;l.freeDrawingBrush.width=n;l.freeDrawingBrush.color=a();f();u=l.getActiveObject();null!=u&&("circle"===u.type||"rect"===u.type||"ellipse"===u.type?(u.set("strokeWidth",n),l.renderAll()):"textbox"===u.type&&(u.set("fontSize",n),l.renderAll()),C(),h());d()}});jQuery("#"+r+" div.opacity_range_ui").slider({min:1,max:100,value:100,change:function(n,u){n=a();l.freeDrawingBrush.width=b();l.freeDrawingBrush.color=n;f();u=l.getActiveObject();null!=u&&("circle"===u.type||"rect"===u.type||"ellipse"===
u.type?(u.set("stroke",n),l.renderAll()):"textbox"===u.type&&(u.set("fill",n),l.renderAll()),C(),h());d()}})})();(function(){jQuery("#"+r+" div.o_group_colors a").on("click",function(){jQuery("#"+r+" div.o_group_colors a").removeClass("active");jQuery(this).addClass("active");var n=a();l.freeDrawingBrush.color=n;var u=l.getActiveObject();null!=u&&("circle"===u.type||"rect"===u.type||"ellipse"===u.type?(u.set("stroke",n),l.renderAll()):"textbox"===u.type&&(u.set("fill",n),l.renderAll()));C();f();h()})})();
(function(){jQuery("#"+r+" a.clear").on("click",function(){var n=l.getActiveObject();null!=n&&(l.remove(n),l.renderAll());C();h()});jQuery("#"+r+" a.clearall").on("click",function(){var n=o_getMainWin();var u=n?jQuery(document).ooTranslator().getTranslator(n.o_info.locale,"org.olat.ims.qti21.ui"):{translate:function(D){return D}};n=u.translate("cancel");var B=u.translate("paint.erase");u='\x3cdiv id\x3d"paintModal" class\x3d"modal fade" tabindex\x3d"-1" role\x3d"dialog"\x3e  \x3cdiv class\x3d"modal-dialog" role\x3d"document"\x3e    \x3cdiv class\x3d"modal-content"\x3e      \x3cdiv class\x3d"modal-body"\x3e        \x3cp\x3e'+
(u.translate("paint.erase.hint")+"\x3c/p\x3e      \x3c/div\x3e");u=u+'      \x3cdiv class\x3d"modal-footer"\x3e        \x3cbutton type\x3d"button" class\x3d"btn btn-default" data-dismiss\x3d"modal"\x3e'+(n+'\x3c/button\x3e        \x3cbutton type\x3d"button" class\x3d"btn btn-primary" data-dismiss\x3d"modal"\x3e')+(B+"\x3c/button\x3e");u+="      \x3c/div\x3e";u+="    \x3c/div\x3e";u+="  \x3c/div\x3e";u+="\x3c/div\x3e";jQuery("body").append(u);jQuery("#paintModal").modal("show");jQuery("#paintModal button.btn-primary").on("click",
function(){l.clear();try{l.getObjects();jQuery("#op_"+g+"_png").val("");var D=JSON.stringify(l);jQuery("#op_"+g+"_json").val("data:application/json;base64,"+D)}catch(E){window.console&&console.log(E)}h()});jQuery("#paintModal").on("hidden.bs.modal",function(D){jQuery("#paintModal").remove()});o_scrollTop()})})();var z=jQuery("#op_"+g+"_json").val();t="undefined"!=typeof z&&0<z.length;p=null;t&&(p=JSON.parse(z));try{var A=z&&null!=p&&p.objects&&0<p.objects.length}catch(n){window.console&&console.log(n),
A=!1}A?(m(jQuery("#"+r+" div.o_group_tools a[data-tool\x3dselect]")[0]),l.isDrawingMode=!1):(m(jQuery("#"+r+" div.o_group_tools a[data-tool\x3dbrush]")[0]),jQuery("#"+r+" div.o_group_colors a.blue").addClass("active"),l.isDrawingMode=!0,l.freeDrawingBrush.width=b(),l.freeDrawingBrush.color=a());f();A=function(n){n=n.target;if("textbox"===n.type)c(n.fill),e(n.fontSize);else if("circle"===n.type||"rect"===n.type||"ellipse"===n.type)c(n.stroke),e(n.strokeWidth)};l.on("selection:created",A);l.on("selection:updated",
A);var C=function(){try{l.getObjects();var n=l.toDataURL("png");jQuery("#op_"+g+"_png").val(n);var u=JSON.stringify(l);jQuery("#op_"+g+"_json").val("data:application/json;base64,"+u)}catch(B){window.console&&console.log(B)}};l.on("object:modified",C);l.on("object:added",C);l.on("object:removed",C);l.on("mouse:out",C);t&&l.loadFromJSON(p,function(){l.renderAll()},function(n,u){u.isType("circle")&&u.setControlsVisibility({ml:!1,mb:!1,mr:!1,mt:!1,mtr:!1})});l.on("object:modified",h);l.on("object:added",
h);l.on("object:removed",h)}})(jQuery);